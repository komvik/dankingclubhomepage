{"version":3,"sources":["../../src/telemetry/generate.ts"],"sourcesContent":["/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ValueType } from '@opentelemetry/api';\nimport { ReadableSpan } from '@opentelemetry/sdk-trace-base';\nimport { createHash } from 'crypto';\nimport {\n  GenerateRequestData,\n  GenerateResponseData,\n  GenerationUsage,\n  GENKIT_VERSION,\n  MediaPart,\n  Part,\n  ToolRequestPart,\n  ToolResponsePart,\n} from 'genkit';\nimport { logger } from 'genkit/logging';\nimport { PathMetadata, toDisplayPath } from 'genkit/tracing';\nimport {\n  internalMetricNamespaceWrap,\n  MetricCounter,\n  MetricHistogram,\n  Telemetry,\n} from '../metrics.js';\nimport {\n  createCommonLogAttributes,\n  extractErrorName,\n  extractOuterFeatureNameFromPath,\n} from '../utils.js';\n\ntype SharedDimensions = {\n  modelName?: string;\n  featureName?: string;\n  path?: string;\n  temperature?: number;\n  topK?: number;\n  topP?: number;\n  status?: string;\n  source?: string;\n  sourceVersion?: string;\n};\n\nclass GenerateTelemetry implements Telemetry {\n  /**\n   * Wraps the declared metrics in a Genkit-specific, internal namespace.\n   */\n  private _N = internalMetricNamespaceWrap.bind(null, 'ai');\n\n  /** The maximum length (in characters) of a logged prompt message. */\n  private MAX_LOG_CONTENT_CHARS = 128_000;\n\n  private actionCounter = new MetricCounter(this._N('generate/requests'), {\n    description: 'Counts calls to genkit generate actions.',\n    valueType: ValueType.INT,\n  });\n\n  private latencies = new MetricHistogram(this._N('generate/latency'), {\n    description: 'Latencies when interacting with a Genkit model.',\n    valueType: ValueType.DOUBLE,\n    unit: 'ms',\n  });\n\n  private inputCharacters = new MetricCounter(\n    this._N('generate/input/characters'),\n    {\n      description: 'Counts input characters to any Genkit model.',\n      valueType: ValueType.INT,\n    }\n  );\n\n  private inputTokens = new MetricCounter(this._N('generate/input/tokens'), {\n    description: 'Counts input tokens to a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  private inputImages = new MetricCounter(this._N('generate/input/images'), {\n    description: 'Counts input images to a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  private inputVideos = new MetricCounter(this._N('generate/input/videos'), {\n    description: 'Counts input videos to a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  private inputAudio = new MetricCounter(this._N('generate/input/audio'), {\n    description: 'Counts input audio files to a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  private outputCharacters = new MetricCounter(\n    this._N('generate/output/characters'),\n    {\n      description: 'Counts output characters from a Genkit model.',\n      valueType: ValueType.INT,\n    }\n  );\n\n  private outputTokens = new MetricCounter(this._N('generate/output/tokens'), {\n    description: 'Counts output tokens from a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  private outputImages = new MetricCounter(this._N('generate/output/images'), {\n    description: 'Count output images from a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  private outputVideos = new MetricCounter(this._N('generate/output/videos'), {\n    description: 'Count output videos from a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  private outputAudio = new MetricCounter(this._N('generate/output/audio'), {\n    description: 'Count output audio files from a Genkit model.',\n    valueType: ValueType.INT,\n  });\n\n  tick(\n    span: ReadableSpan,\n    paths: Set<PathMetadata>,\n    logIO: boolean,\n    projectId?: string\n  ): void {\n    const attributes = span.attributes;\n    const modelName = attributes['genkit:name'] as string;\n    const path = (attributes['genkit:path'] as string) || '';\n    const input =\n      'genkit:input' in attributes\n        ? (JSON.parse(\n            attributes['genkit:input']! as string\n          ) as GenerateRequestData)\n        : undefined;\n    const output =\n      'genkit:output' in attributes\n        ? (JSON.parse(\n            attributes['genkit:output']! as string\n          ) as GenerateResponseData)\n        : undefined;\n\n    const errName = extractErrorName(span.events);\n    let featureName = (attributes['genkit:metadata:flow:name'] ||\n      extractOuterFeatureNameFromPath(path)) as string;\n    if (!featureName || featureName === '<unknown>') {\n      featureName = 'generate';\n    }\n\n    if (input) {\n      this.recordGenerateActionMetrics(modelName, featureName, path, input, {\n        response: output,\n        errName,\n      });\n      this.recordGenerateActionConfigLogs(\n        span,\n        modelName,\n        featureName,\n        path,\n        input,\n        projectId\n      );\n\n      if (logIO) {\n        this.recordGenerateActionInputLogs(\n          span,\n          modelName,\n          featureName,\n          path,\n          input,\n          projectId\n        );\n      }\n    }\n\n    if (output && logIO) {\n      this.recordGenerateActionOutputLogs(\n        span,\n        modelName,\n        featureName,\n        path,\n        output,\n        projectId\n      );\n    }\n  }\n\n  private recordGenerateActionMetrics(\n    modelName: string,\n    featureName: string,\n    path: string,\n    input: GenerateRequestData,\n    opts: {\n      response?: GenerateResponseData;\n      errName?: string;\n    }\n  ) {\n    this.doRecordGenerateActionMetrics(modelName, opts.response?.usage || {}, {\n      featureName,\n      path,\n      latencyMs: opts.response?.latencyMs,\n      errName: opts.errName,\n      source: 'ts',\n      sourceVersion: GENKIT_VERSION,\n    });\n  }\n\n  private recordGenerateActionConfigLogs(\n    span: ReadableSpan,\n    model: string,\n    featureName: string,\n    qualifiedPath: string,\n    input: GenerateRequestData,\n    projectId?: string\n  ) {\n    const path = toDisplayPath(qualifiedPath);\n    const sharedMetadata = {\n      ...createCommonLogAttributes(span, projectId),\n      model,\n      path,\n      qualifiedPath,\n      featureName,\n    };\n    logger.logStructured(`Config[${path}, ${model}]`, {\n      ...sharedMetadata,\n      temperature: input.config?.temperature,\n      topK: input.config?.topK,\n      topP: input.config?.topP,\n      maxOutputTokens: input.config?.maxOutputTokens,\n      stopSequences: input.config?.stopSequences,\n      source: 'ts',\n      sourceVersion: GENKIT_VERSION,\n    });\n  }\n\n  private recordGenerateActionInputLogs(\n    span: ReadableSpan,\n    model: string,\n    featureName: string,\n    qualifiedPath: string,\n    input: GenerateRequestData,\n    projectId?: string\n  ) {\n    const path = toDisplayPath(qualifiedPath);\n    const sharedMetadata = {\n      ...createCommonLogAttributes(span, projectId),\n      model,\n      path,\n      qualifiedPath,\n      featureName,\n    };\n\n    const messages = input.messages.length;\n    input.messages.forEach((msg, msgIdx) => {\n      const parts = msg.content.length;\n      msg.content.forEach((part, partIdx) => {\n        const partCounts = this.toPartCounts(partIdx, parts, msgIdx, messages);\n        logger.logStructured(`Input[${path}, ${model}] ${partCounts}`, {\n          ...sharedMetadata,\n          content: this.toPartLogContent(part),\n          partIndex: partIdx,\n          totalParts: parts,\n          messageIndex: msgIdx,\n          totalMessages: messages,\n        });\n      });\n    });\n  }\n\n  private recordGenerateActionOutputLogs(\n    span: ReadableSpan,\n    model: string,\n    featureName: string,\n    qualifiedPath: string,\n    output: GenerateResponseData,\n    projectId?: string\n  ) {\n    const path = toDisplayPath(qualifiedPath);\n    const sharedMetadata = {\n      ...createCommonLogAttributes(span, projectId),\n      model,\n      path,\n      qualifiedPath,\n      featureName,\n    };\n    const message = output.message || output.candidates?.[0]?.message!;\n\n    const parts = message.content.length;\n    message.content.forEach((part, partIdx) => {\n      const partCounts = this.toPartCounts(partIdx, parts, 0, 1);\n      const initial = output.finishMessage\n        ? { finishMessage: this.toPartLogText(output.finishMessage) }\n        : {};\n      logger.logStructured(`Output[${path}, ${model}] ${partCounts}`, {\n        ...initial,\n        ...sharedMetadata,\n        content: this.toPartLogContent(part),\n        partIndex: partIdx,\n        totalParts: parts,\n        candidateIndex: 0,\n        totalCandidates: 1,\n        messageIndex: 0,\n        finishReason: output.finishReason,\n      });\n    });\n  }\n\n  private toPartCounts(\n    partOrdinal: number,\n    parts: number,\n    msgOrdinal: number,\n    messages: number\n  ): string {\n    if (parts > 1 && messages > 1) {\n      return `(part ${this.xOfY(partOrdinal, parts)} in message ${this.xOfY(\n        msgOrdinal,\n        messages\n      )})`;\n    }\n    if (parts > 1) {\n      return `(part ${this.xOfY(partOrdinal, parts)})`;\n    }\n    if (messages > 1) {\n      return `(message ${this.xOfY(msgOrdinal, messages)})`;\n    }\n    return '';\n  }\n\n  private xOfY(x: number, y: number): string {\n    return `${x + 1} of ${y}`;\n  }\n\n  private toPartLogContent(part: Part): string {\n    if (part.text) {\n      return this.toPartLogText(part.text);\n    }\n    if (part.data) {\n      return this.toPartLogText(JSON.stringify(part.data));\n    }\n    if (part.media) {\n      return this.toPartLogMedia(part);\n    }\n    if (part.toolRequest) {\n      return this.toPartLogToolRequest(part);\n    }\n    if (part.toolResponse) {\n      return this.toPartLogToolResponse(part);\n    }\n    if (part.custom) {\n      return this.toPartLogText(JSON.stringify(part.custom));\n    }\n    return '<unknown format>';\n  }\n\n  private toPartLogText(text: string): string {\n    return text.substring(0, this.MAX_LOG_CONTENT_CHARS);\n  }\n\n  private toPartLogMedia(part: MediaPart): string {\n    if (part.media.url.startsWith('data:')) {\n      const splitIdx = part.media.url.indexOf('base64,');\n      if (splitIdx < 0) {\n        return '<unknown media format>';\n      }\n      const prefix = part.media.url.substring(0, splitIdx + 7);\n      const hashedContent = createHash('sha256')\n        .update(part.media.url.substring(splitIdx + 7))\n        .digest('hex');\n      return `${prefix}<sha256(${hashedContent})>`;\n    }\n    return this.toPartLogText(part.media.url);\n  }\n\n  private toPartLogToolRequest(part: ToolRequestPart): string {\n    const inputText =\n      typeof part.toolRequest.input === 'string'\n        ? part.toolRequest.input\n        : JSON.stringify(part.toolRequest.input);\n    return this.toPartLogText(\n      `Tool request: ${part.toolRequest.name}, ref: ${part.toolRequest.ref}, input: ${inputText}`\n    );\n  }\n\n  private toPartLogToolResponse(part: ToolResponsePart): string {\n    const outputText =\n      typeof part.toolResponse.output === 'string'\n        ? part.toolResponse.output\n        : JSON.stringify(part.toolResponse.output);\n    return this.toPartLogText(\n      `Tool response: ${part.toolResponse.name}, ref: ${part.toolResponse.ref}, output: ${outputText}`\n    );\n  }\n\n  /**\n   * Records all metrics associated with performing a GenerateAction.\n   */\n  private doRecordGenerateActionMetrics(\n    modelName: string,\n    usage: GenerationUsage,\n    dimensions: {\n      featureName?: string;\n      path?: string;\n      latencyMs?: number;\n      errName?: string;\n      source?: string;\n      sourceVersion: string;\n    }\n  ) {\n    const shared: SharedDimensions = {\n      modelName: modelName,\n      featureName: dimensions.featureName,\n      path: dimensions.path,\n      source: dimensions.source,\n      sourceVersion: dimensions.sourceVersion,\n      status: dimensions.errName ? 'failure' : 'success',\n    };\n\n    this.actionCounter.add(1, {\n      error: dimensions.errName,\n      ...shared,\n    });\n\n    this.latencies.record(dimensions.latencyMs, shared);\n\n    // inputs\n    this.inputTokens.add(usage.inputTokens, shared);\n    this.inputCharacters.add(usage.inputCharacters, shared);\n    this.inputImages.add(usage.inputImages, shared);\n    this.inputVideos.add(usage.inputVideos, shared);\n    this.inputAudio.add(usage.inputAudioFiles, shared);\n\n    // outputs\n    this.outputTokens.add(usage.outputTokens, shared);\n    this.outputCharacters.add(usage.outputCharacters, shared);\n    this.outputImages.add(usage.outputImages, shared);\n    this.outputVideos.add(usage.outputVideos, shared);\n    this.outputAudio.add(usage.outputAudioFiles, shared);\n  }\n}\n\nconst generateTelemetry = new GenerateTelemetry();\nexport { generateTelemetry };\n"],"mappings":"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","names":[]}